function M = getM_dualArmV2(q,beta,L)
	% Extract joint variables from input vectors
	q1 = q(1);
	q2 = q(2);
	q3 = q(3);
	q4 = q(4);
	q5 = q(5);
	q6 = q(6);
	q7 = q(7);

	% Extract link length parameters
	L1 = L(1);
	L2 = L(2);
	L3 = L(3);
	L4 = L(4);
	L5 = L(5);
	L6 = L(6);

    %% obtain the regression of base parameter set
	% XX
	I1xx=0;I2xx=beta(1);I3xx=beta(2);I4xx=beta(3);I5xx=beta(4);I6xx=beta(5);I7xx=beta(6);
	% XY
	I1xy=0;I2xy=beta(7);I3xy=beta(8);I4xy=beta(9);I5xy=beta(10);I6xy=beta(11);I7xy=beta(12);
	% XZ
	I1xz=0;I2xz=beta(13);I3xz=beta(14);I4xz=beta(15);I5xz=beta(16);I6xz=beta(17);I7xz=beta(18);
	% YZ
	I1yz=0;I2yz=beta(19);I3yz=beta(20);I4yz=beta(21);I5yz=beta(22);I6yz=beta(23);I7yz=beta(24);
	% ZZ
	I1zz=beta(25);I2zz=beta(26);I3zz=beta(27);I4zz=beta(28);I5zz=beta(29);I6zz=beta(30);I7zz=beta(31);
	% MX
	mx1=beta(32);mx2=beta(33);mx3=beta(34);mx4=beta(35);mx5=beta(36);mx6=beta(37);mx7=beta(38);
	% MY
	my1=beta(39);my2=beta(40);my3=beta(41);my4=beta(42);my5=beta(43);my6=beta(44);my7=beta(45);
	% IA
	Ia1=0;Ia2=0;Ia3=beta(46);Ia4=beta(47);Ia5=beta(48);Ia6=beta(49);Ia7=beta(50);
	% M = 0
	m1 = 0;m2 = 0;m3 = 0;m4 = 0;m5 = 0;m6 = 0;m7 = 0;
	% MZ = 0
	mz1 = 0;mz2 = 0;mz3 = 0;mz4 = 0;mz5 = 0;mz6 = 0;mz7 = 0;
	% YY = 0
	I1yy = 0;I2yy = 0;I3yy = 0;I4yy = 0;I5yy =0;I6yy = 0;I7yy = 0;
	% payload = 0
	mL= 0;mxL= 0;myL= 0;mzL= 0;ILxx= 0;ILxy= 0;ILxz= 0;ILyy= 0;ILyz= 0;ILzz= 0;



	S2=sin(q2);
	C2=cos(q2);
	S3=sin(q3);
	C3=cos(q3);
	S4=sin(q4);
	C4=cos(q4);
	S5=sin(q5);
	C5=cos(q5);
	S6=-cos(q6);
	C6=sin(q6);
	S7=sin(q7);
	C7=cos(q7);
	PAS218=L6.*myL;
	PAS228=-(L6.*mxL);
	PAS318=L6.*mzL;
	PAS338=-(L6.*mxL);
	XXP7=I7xx + ILxx;
	XYP7=I7xy + ILxy - PAS218;
	XZP7=I7xz + ILxz - PAS318;
	YYP7=I7yy + ILyy + L6.^2.*mL - 2.*PAS228;
	YZP7=I7yz + ILyz;
	ZZP7=I7zz + ILzz + L6.^2.*mL - 2.*PAS338;
	MXP7=L6.*mL + mx7 + mxL;
	MYP7=my7 + myL;
	MZP7=mz7 + mzL;
	MP7=m7 + mL;
	AS17=C7.*MXP7 - MYP7.*S7;
	AS37=C7.*MYP7 + MXP7.*S7;
	AJ117=-((I7xy + ILxy - PAS218).*S7) + C7.*XXP7;
	AJ127=C7.*XYP7 - S7.*YYP7;
	AJ137=C7.*XZP7 - S7.*YZP7;
	AJ217=-I7xz - ILxz + PAS318;
	AJ227=-I7yz - ILyz;
	AJ317=C7.*(I7xy + ILxy - PAS218) + S7.*XXP7;
	AJ327=S7.*XYP7 + C7.*YYP7;
	AJ337=S7.*XZP7 + C7.*YZP7;
	AJA117=AJ117.*C7 - AJ127.*S7;
	AJA217=AJ217.*C7 - AJ227.*S7;
	AJA317=AJ317.*C7 - AJ327.*S7;
	AJA337=AJ327.*C7 + AJ317.*S7;
	PAS217=-(L5.*MZP7);
	PAS227=-(AS17.*L5);
	PAS317=AS37.*L5;
	PAS337=-(AS17.*L5);
	XXP6=AJA117 + I6xx;
	XYP6=AJA217 + I6xy - PAS217;
	XZP6=AJA317 + I6xz - PAS317;
	YYP6=I6yy + L5.^2.*MP7 - 2.*PAS227 + ZZP7;
	YZP6=-AJ337 + I6yz;
	ZZP6=AJA337 + I6zz + L5.^2.*MP7 - 2.*PAS337;
	MXP6=AS17 + L5.*MP7 + mx6;
	MYP6=my6 - MZP7;
	MZP6=AS37 + mz6;
	MP6=m6 + MP7;
	AS16=C6.*MXP6 - MYP6.*S6;
	AS36=-(C6.*MYP6) - MXP6.*S6;
	AJ116=-((AJA217 + I6xy - PAS217).*S6) + C6.*XXP6;
	AJ126=C6.*XYP6 - S6.*YYP6;
	AJ136=C6.*XZP6 - S6.*YZP6;
	AJ216=AJA317 + I6xz - PAS317;
	AJ226=-AJ337 + I6yz;
	AJ316=-(C6.*(AJA217 + I6xy - PAS217)) - S6.*XXP6;
	AJ326=-(S6.*XYP6) - C6.*YYP6;
	AJ336=-(S6.*XZP6) - C6.*YZP6;
	AJA116=AJ116.*C6 - AJ126.*S6;
	AJA216=AJ216.*C6 - AJ226.*S6;
	AJA316=AJ316.*C6 - AJ326.*S6;
	AJA336=-(AJ326.*C6) - AJ316.*S6;
	XXP5=AJA116 + I5xx;
	XYP5=AJA216 + I5xy;
	XZP5=AJA316 + I5xz;
	YYP5=I5yy + ZZP6;
	YZP5=AJ336 + I5yz;
	ZZP5=AJA336 + I5zz;
	MXP5=AS16 + mx5;
	MYP5=my5 + MZP6;
	MZP5=AS36 + mz5;
	MP5=m5 + MP6;
	AS15=C5.*MXP5 - MYP5.*S5;
	AS35=C5.*MYP5 + MXP5.*S5;
	AJ115=-((AJA216 + I5xy).*S5) + C5.*XXP5;
	AJ125=C5.*XYP5 - S5.*YYP5;
	AJ135=C5.*XZP5 - S5.*YZP5;
	AJ215=-AJA316 - I5xz;
	AJ225=-AJ336 - I5yz;
	AJ315=C5.*(AJA216 + I5xy) + S5.*XXP5;
	AJ325=S5.*XYP5 + C5.*YYP5;
	AJ335=S5.*XZP5 + C5.*YZP5;
	AJA115=AJ115.*C5 - AJ125.*S5;
	AJA215=AJ215.*C5 - AJ225.*S5;
	AJA315=AJ315.*C5 - AJ325.*S5;
	AJA335=AJ325.*C5 + AJ315.*S5;
	PAS115=-(L4.*MZP5);
	PAS125=-(AS15.*L4);
	PAS325=-(AS35.*L4);
	PAS335=-(L4.*MZP5);
	XXP4=AJA115 + I4xx + L4.^2.*MP5 - 2.*PAS115;
	XYP4=AJA215 + I4xy - PAS125;
	XZP4=AJA315 + I4xz;
	YYP4=I4yy + ZZP5;
	YZP4=-AJ335 + I4yz - PAS325;
	ZZP4=AJA335 + I4zz + L4.^2.*MP5 - 2.*PAS335;
	MXP4=AS15 + mx4;
	MYP4=-(L4.*MP5) + my4 - MZP5;
	MZP4=AS35 + mz4;
	MP4=m4 + MP5;
	AS14=C4.*MXP4 - MYP4.*S4;
	AS34=-(C4.*MYP4) - MXP4.*S4;
	AJ114=-((AJA215 + I4xy - PAS125).*S4) + C4.*XXP4;
	AJ124=C4.*XYP4 - S4.*YYP4;
	AJ134=C4.*XZP4 - S4.*YZP4;
	AJ214=AJA315 + I4xz;
	AJ224=-AJ335 + I4yz - PAS325;
	AJ314=-(C4.*(AJA215 + I4xy - PAS125)) - S4.*XXP4;
	AJ324=-(S4.*XYP4) - C4.*YYP4;
	AJ334=-(S4.*XZP4) - C4.*YZP4;
	AJA114=AJ114.*C4 - AJ124.*S4;
	AJA214=AJ214.*C4 - AJ224.*S4;
	AJA314=AJ314.*C4 - AJ324.*S4;
	AJA334=-(AJ324.*C4) - AJ314.*S4;
	PAS214=L3.*MZP4;
	PAS224=-(AS14.*L3);
	PAS314=AS34.*L3;
	PAS334=-(AS14.*L3);
	XXP3=AJA114 + I3xx;
	XYP3=AJA214 + I3xy - PAS214;
	XZP3=AJA314 + I3xz - PAS314;
	YYP3=I3yy + L3.^2.*MP4 - 2.*PAS224 + ZZP4;
	YZP3=AJ334 + I3yz;
	ZZP3=AJA334 + I3zz + L3.^2.*MP4 - 2.*PAS334;
	MXP3=AS14 + L3.*MP4 + mx3;
	MYP3=my3 + MZP4;
	MZP3=AS34 + mz3;
	MP3=m3 + MP4;
	AS13=C3.*MXP3 - MYP3.*S3;
	AS33=C3.*MYP3 + MXP3.*S3;
	AJ113=-((AJA214 + I3xy - PAS214).*S3) + C3.*XXP3;
	AJ123=C3.*XYP3 - S3.*YYP3;
	AJ133=C3.*XZP3 - S3.*YZP3;
	AJ213=-AJA314 - I3xz + PAS314;
	AJ223=-AJ334 - I3yz;
	AJ313=C3.*(AJA214 + I3xy - PAS214) + S3.*XXP3;
	AJ323=S3.*XYP3 + C3.*YYP3;
	AJ333=S3.*XZP3 + C3.*YZP3;
	AJA113=AJ113.*C3 - AJ123.*S3;
	AJA213=AJ213.*C3 - AJ223.*S3;
	AJA313=AJ313.*C3 - AJ323.*S3;
	AJA333=AJ323.*C3 + AJ313.*S3;
	PAS113=-(L2.*MZP3);
	PAS123=-(AS13.*L2);
	PAS323=-(AS33.*L2);
	PAS333=-(L2.*MZP3);
	XXP2=AJA113 + I2xx + L2.^2.*MP3 - 2.*PAS113;
	XYP2=AJA213 + I2xy - PAS123;
	XZP2=AJA313 + I2xz;
	YYP2=I2yy + ZZP3;
	YZP2=-AJ333 + I2yz - PAS323;
	ZZP2=AJA333 + I2zz + L2.^2.*MP3 - 2.*PAS333;
	AJ312=-(C2.*(AJA213 + I2xy - PAS123)) - S2.*XXP2;
	AJ322=-(S2.*XYP2) - C2.*YYP2;
	AJ332=-(S2.*XZP2) - C2.*YZP2;
	AJA332=-(AJ322.*C2) - AJ312.*S2;
	ZZP1=AJA332 + I1zz;
	EC12=-(C3.*MYP3) - MXP3.*S3;
	EC32=C3.*MXP3 - MYP3.*S3;
	NC12=AJ133 - EC32.*L2;
	NC32=AJ333 + EC12.*L2;
	NC33=-(NC12.*S2) + C2.*ZZP3;
	ED12=-(C4.*MYP4) - MXP4.*S4;
	ED32=-(C4.*MXP4) + MYP4.*S4;
	ND22=-(ED32.*L3) + ZZP4;
	ED13=C3.*ED12;
	ED33=ED12.*S3;
	ND13=AJ134.*C3 - ED33.*L2 - ND22.*S3;
	ND33=ED13.*L2 + C3.*ND22 + AJ134.*S3;
	ND34=AJ334.*C2 - ND13.*S2;
	EE12=-(C5.*MYP5) - MXP5.*S5;
	EE32=C5.*MXP5 - MYP5.*S5;
	NE12=AJ135 - EE32.*L4;
	NE32=AJ335 + EE12.*L4;
	EE13=C4.*EE12;
	EE33=-(EE12.*S4);
	NE13=C4.*NE12 + S4.*ZZP5;
	NE23=-(EE33.*L3) + NE32;
	NE33=EE32.*L3 - NE12.*S4 + C4.*ZZP5;
	EE14=C3.*EE13 - EE32.*S3;
	EE34=C3.*EE32 + EE13.*S3;
	NE14=-(EE34.*L2) + C3.*NE13 - NE23.*S3;
	NE34=EE14.*L2 + C3.*NE23 + NE13.*S3;
	NE35=C2.*NE33 - NE14.*S2;
	EF12=-(C6.*MYP6) - MXP6.*S6;
	EF32=-(C6.*MXP6) + MYP6.*S6;
	EF13=C5.*EF12;
	EF33=EF12.*S5;
	NF13=AJ136.*C5 - EF33.*L4 - S5.*ZZP6;
	NF33=EF13.*L4 + AJ136.*S5 + C5.*ZZP6;
	EF14=C4.*EF13 + EF32.*S4;
	EF34=C4.*EF32 - EF13.*S4;
	NF14=C4.*NF13 + AJ336.*S4;
	NF24=-(EF34.*L3) + NF33;
	NF34=AJ336.*C4 + EF33.*L3 - NF13.*S4;
	EF15=C3.*EF14 - EF33.*S3;
	EF35=C3.*EF33 + EF14.*S3;
	NF15=-(EF35.*L2) + C3.*NF14 - NF24.*S3;
	NF35=EF15.*L2 + C3.*NF24 + NF14.*S3;
	NF36=C2.*NF34 - NF15.*S2;
	EG12=-(C7.*MYP7) - MXP7.*S7;
	EG32=C7.*MXP7 - MYP7.*S7;
	NG22=-(EG32.*L5) - ZZP7;
	EG13=C6.*EG12;
	EG33=-(EG12.*S6);
	NG13=AJ137.*C6 - NG22.*S6;
	NG33=-(C6.*NG22) - AJ137.*S6;
	EG14=C5.*EG13 - EG32.*S5;
	EG34=C5.*EG32 + EG13.*S5;
	NG14=-(EG34.*L4) + C5.*NG13 - AJ337.*S5;
	NG34=AJ337.*C5 + EG14.*L4 + NG13.*S5;
	EG15=C4.*EG14 + EG33.*S4;
	EG35=C4.*EG33 - EG14.*S4;
	NG15=C4.*NG14 + NG33.*S4;
	NG25=-(EG35.*L3) + NG34;
	NG35=EG34.*L3 + C4.*NG33 - NG14.*S4;
	EG16=C3.*EG15 - EG34.*S3;
	EG36=C3.*EG34 + EG15.*S3;
	NG16=-(EG36.*L2) + C3.*NG15 - NG25.*S3;
	NG36=EG16.*L2 + C3.*NG25 + NG15.*S3;
	NG37=C2.*NG35 - NG16.*S2;
	A(1,1)=Ia1 + ZZP1;
	A(2,1)=AJ332;
	A(3,1)=NC33;
	A(4,1)=ND34;
	A(5,1)=NE35;
	A(6,1)=NF36;
	A(7,1)=NG37;
	A(2,2)=Ia2 + ZZP2;
	A(3,2)=NC32;
	A(4,2)=ND33;
	A(5,2)=NE34;
	A(6,2)=NF35;
	A(7,2)=NG36;
	A(3,3)=Ia3 + ZZP3;
	A(4,3)=AJ334;
	A(5,3)=NE33;
	A(6,3)=NF34;
	A(7,3)=NG35;
	A(4,4)=Ia4 + ZZP4;
	A(5,4)=NE32;
	A(6,4)=NF33;
	A(7,4)=NG34;
	A(5,5)=Ia5 + ZZP5;
	A(6,5)=AJ336;
	A(7,5)=NG33;
	A(6,6)=Ia6 + ZZP6;
	A(7,6)=AJ337;
	A(7,7)=Ia7 + ZZP7;
%% get simplified M

    M(1,1)=(A(1,1));
    M(2,1)=(A(2,1));
    M(3,1)=(A(3,1));
    M(4,1)=(A(4,1));
    M(5,1)=(A(5,1));
    M(6,1)=(A(6,1));
    M(7,1)=(A(7,1));
    M(2,2)=(A(2,2));
    M(3,2)=(A(3,2));
    M(4,2)=(A(4,2));
    M(5,2)=(A(5,2));
    M(6,2)=(A(6,2));
    M(7,2)=(A(7,2));
    M(3,3)=(A(3,3));
    M(4,3)=(A(4,3));
    M(5,3)=(A(5,3));
    M(6,3)=(A(6,3));
    M(7,3)=(A(7,3));
    M(4,4)=(A(4,4));
    M(5,4)=(A(5,4));
    M(6,4)=(A(6,4));
    M(7,4)=(A(7,4));
    M(5,5)=(A(5,5));
    M(6,5)=(A(6,5));
    M(7,5)=(A(7,5));
    M(6,6)=(A(6,6));
    M(7,6)=(A(7,6));
    M(7,7)=(A(7,7));
    M(1,1)=M(1,1);
    M(1,2)=M(2,1);
    M(1,3)=M(3,1);
    M(1,4)=M(4,1);
    M(1,5)=M(5,1);
    M(1,6)=M(6,1);
    M(1,7)=M(7,1);
    M(2,2)=M(2,2);
    M(2,3)=M(3,2);
    M(2,4)=M(4,2);
    M(2,5)=M(5,2);
    M(2,6)=M(6,2);
    M(2,7)=M(7,2);
    M(3,3)=M(3,3);
    M(3,4)=M(4,3);
    M(3,5)=M(5,3);
    M(3,6)=M(6,3);
    M(3,7)=M(7,3);
    M(4,4)=M(4,4);
    M(4,5)=M(5,4);
    M(4,6)=M(6,4);
    M(4,7)=M(7,4);
    M(5,5)=M(5,5);
    M(5,6)=M(6,5);
    M(5,7)=M(7,5);
    M(6,6)=M(6,6);
    M(6,7)=M(7,6);
    
    % *=*
    % Number of operations : 267 '+' or '-', 308 '*' or '/'
 end